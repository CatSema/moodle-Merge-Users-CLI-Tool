# Merge Users CLI Tool

Этот скрипт автоматизирует процесс слияния пользователей в Moodle с использованием плагина `moodle-tool_mergeusers`. Он читает данные из CSV файла, передает идентификаторы пользователей в командную строку и логирует результаты слияния.

## Описание

Скрипт:
1. Настроит логирование ошибок и информации в файл и в консоль.
2. Прочитает CSV файл с данными пользователей для слияния.
3. Для каждого пользователя из CSV передаст идентификаторы `fromid` и `toid` в CLI-интерфейс плагина `moodle-tool_mergeusers`.
4. Логирует результаты слияния пользователей, включая успешные и ошибочные записи.
5. Завершит процесс после обработки всех строк в CSV.

## Требования

- Python 3.x
- Плагин `moodle-tool_mergeusers` установлен в вашем Moodle.
- Доступ к командной строке Moodle с правами `sudo`.
- Рабочий скрипт `climerger.php` плагина `moodle-tool_mergeusers`.
- CSV файл, содержащий столбцы `fromid` и `toid`.

## Установка

1. Клонируйте репозиторий:

   ```bash
   git clone https://github.com/yourusername/merge-users-cli.git
   cd merge-users-cli
   ```

2. Убедитесь, что на вашей системе установлен Python 3 и библиотека для работы с CSV и процессами.

3. Убедитесь, что у вас установлен и настроен плагин `moodle-tool_mergeusers` в вашем Moodle.

4. Убедитесь, что у вас есть доступ к командной строке Moodle с правами `sudo`.

## Использование

1. Создайте CSV файл с данными пользователей для слияния. CSV файл должен содержать два столбца:
   - `fromid`: Идентификатор пользователя, которого нужно объединить.
   - `toid`: Идентификатор пользователя, с которым нужно объединить.

   Пример CSV:
   ```csv
   fromid;toid
   123;456
   789;1011
   ```

2. Запустите скрипт с указанием пути к вашему CSV файлу:

   ```bash
   python merge_users.py /path/to/users_to_merge.csv
   ```

3. Скрипт автоматически выполнит слияние пользователей через командный интерфейс плагина `moodle-tool_mergeusers` и выведет результаты в консоль и в лог файл `merge_users.log`.

## Логирование

- Логи с информацией и ошибками будут записываться в файл `merge_users.log`.
- Также выводится информация в консоль о каждом шаге слияния, включая успешные и ошибочные объединения.

## Примечания

- Скрипт использует псевдотерминал для взаимодействия с CLI.
- Обработка ошибок и предупреждений осуществляется через логирование и сообщения в консоль.
- Прерывание работы скрипта возможно через `Ctrl+C`.
- Этот скрипт взаимодействует с плагином `moodle-tool_mergeusers`, который должен быть установлен в вашем Moodle для работы с CLI-утилитой `climerger.php`.

## Лицензия

Этот проект лицензирован под MIT License - подробности см. в файле [LICENSE](LICENSE).
